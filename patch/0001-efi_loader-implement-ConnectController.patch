From ad1dcb19a5b818d397fab49fc5ccd64f44a11061 Mon Sep 17 00:00:00 2001
From: Heinrich Schuchardt <xypron.glpk@gmx.de>
Date: Tue, 1 Aug 2017 08:00:01 +0200
Subject: [PATCH 1/1] efi_loader: implement ConnectController

Signed-off-by: Heinrich Schuchardt <xypron.glpk@gmx.de>
---
 lib/efi_loader/efi_boottime.c | 38 ++++++++++++++++++++++++++++++++++++--
 1 file changed, 36 insertions(+), 2 deletions(-)

diff --git a/lib/efi_loader/efi_boottime.c b/lib/efi_loader/efi_boottime.c
index 7740a099d8..144fc9527c 100644
--- a/lib/efi_loader/efi_boottime.c
+++ b/lib/efi_loader/efi_boottime.c
@@ -904,9 +904,43 @@ static efi_status_t EFIAPI efi_connect_controller(
 			struct efi_device_path *remain_device_path,
 			bool recursive)
 {
+	efi_handle_t *free_me = NULL;
+
+	if (!controller_handle)
+		return EFI_INVALID_PARAMETER;
+
+	do {
+		/*  Context Override */
+		if (driver_image_handle)
+			break;
+		/*  Platform Driver Override */
+
+		/* Driver Family Override Search */
+
+		/* Bus Specific Driver Override */
+
+		/* Driver Binding Search */
+
+	} while (0);
+
+	
+
+	return EFI_NOT_FOUND;
+}
+
+static efi_status_t EFIAPI efi_connect_controller_ext(
+			efi_handle_t controller_handle,
+			efi_handle_t *driver_image_handle,
+			struct efi_device_path *remain_device_path,
+			bool recursive)
+{
 	EFI_ENTRY("%p, %p, %p, %d", controller_handle, driver_image_handle,
 		  remain_device_path, recursive);
-	return EFI_EXIT(EFI_NOT_FOUND);
+
+	return EFI_EXIT(efi_connect_controller(controller_handle,
+					       driver_image_handle,
+					       remain_device_path,
+					       recursive));
 }
 
 static efi_status_t EFIAPI efi_disconnect_controller(void *controller_handle,
@@ -1356,7 +1390,7 @@ static const struct efi_boot_services efi_boot_services = {
 	.get_next_monotonic_count = efi_get_next_monotonic_count,
 	.stall = efi_stall,
 	.set_watchdog_timer = efi_set_watchdog_timer,
-	.connect_controller = efi_connect_controller,
+	.connect_controller = efi_connect_controller_ext,
 	.disconnect_controller = efi_disconnect_controller_ext,
 	.open_protocol = efi_open_protocol,
 	.close_protocol = efi_close_protocol,
-- 
2.13.2

