From 3ec6a6211e477e3a0856f3be4069127b1731249d Mon Sep 17 00:00:00 2001
From: Heinrich Schuchardt <xypron.glpk@gmx.de>
Date: Sun, 18 Feb 2018 11:13:28 +0100
Subject: [PATCH 1/1][for v2018.03] efi_loader: clear signaled state in CheckEvent

CheckEvent must clear the signaled state.

Signed-off-by: Heinrich Schuchardt <xypron.glpk@gmx.de>
---
 lib/efi_loader/efi_boottime.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/lib/efi_loader/efi_boottime.c b/lib/efi_loader/efi_boottime.c
index 6eea2395c7..f6113f7920 100644
--- a/lib/efi_loader/efi_boottime.c
+++ b/lib/efi_loader/efi_boottime.c
@@ -816,7 +816,8 @@ static efi_status_t EFIAPI efi_close_event(struct efi_event *event)
  * See the Unified Extensible Firmware Interface (UEFI) specification
  * for details.
  *
- * If an event is not signaled yet the notification function is queued.
+ * If an event is not signaled yet, the notification function is queued.
+ * The signaled state is cleared.
  *
  * @event	event to check
  * @return	status code
@@ -834,8 +835,10 @@ static efi_status_t EFIAPI efi_check_event(struct efi_event *event)
 			break;
 		if (!event->is_signaled)
 			efi_signal_event(event, true);
-		if (event->is_signaled)
+		if (event->is_signaled) {
+			event->is_signaled = false;
 			return EFI_EXIT(EFI_SUCCESS);
+		}
 		return EFI_EXIT(EFI_NOT_READY);
 	}
 	return EFI_EXIT(EFI_INVALID_PARAMETER);
-- 
2.14.2

